#!/bin/bash

if [ ! -f pic32prog/makefile ]
then
    git submodule update --init
fi

case $1 in
'bash')
    COMMAND='bash'
    ;;
*)
    COMMAND='make'
    ;;
esac

docker build --progress=plain --tag build-pic32prog ./docker/build-pic32prog

docker run \
    --rm --interactive --tty \
    --volume $(pwd)/pic32prog:/usr/local/src \
    --user $(id -u):$(id -g) \
    --name build-pic32prog-run \
    build-pic32prog ${COMMAND}